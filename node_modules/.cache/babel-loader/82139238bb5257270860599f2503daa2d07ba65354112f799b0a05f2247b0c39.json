{"ast":null,"code":"var _jsxFileName = \"/home/maksim/src/react/wa-audio-sandbox-20/src/components/WhatsAppAudioRecorder.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function WhatsAppAudioRecorder() {\n  _s();\n  const [recordings, setRecordings] = useState([]);\n  const [isRecording, setIsRecording] = useState(false);\n  const [recordingTime, setRecordingTime] = useState(0);\n  const [audioStream, setAudioStream] = useState(null);\n  const [permissionStatus, setPermissionStatus] = useState('checking');\n  const [error, setError] = useState(null);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [debugInfo, setDebugInfo] = useState({});\n  const mediaRecorderRef = useRef(null);\n  const audioChunksRef = useRef([]);\n  const timerRef = useRef(null);\n  const audioContextRef = useRef(null);\n  const analyserRef = useRef(null);\n  const dataArrayRef = useRef(null);\n  const animationRef = useRef(null);\n  const canvasRef = useRef(null);\n  const streamRef = useRef(null);\n  const debugLog = (message, data = null) => {\n    console.log(`🎤 ${message}`, data);\n    setDebugInfo(prev => ({\n      ...prev,\n      [`${Date.now()}`]: {\n        message,\n        data,\n        time: new Date().toLocaleTimeString()\n      }\n    }));\n  };\n\n  // Strategic permission handling with comprehensive fallbacks\n  const checkAndRequestPermissions = async () => {\n    try {\n      var _testStream$getTracks;\n      debugLog('🔍 Checking microphone permissions...');\n      setPermissionStatus('checking');\n      const testStream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true,\n          sampleRate: 48000,\n          channelCount: 1\n        }\n      });\n      debugLog('✅ Permission granted', {\n        tracks: testStream.getTracks().length,\n        settings: (_testStream$getTracks = testStream.getTracks()[0]) === null || _testStream$getTracks === void 0 ? void 0 : _testStream$getTracks.getSettings()\n      });\n      testStream.getTracks().forEach(track => track.stop());\n      setPermissionStatus('granted');\n      return true;\n    } catch (err) {\n      debugLog('❌ Permission denied', {\n        error: err.message,\n        name: err.name\n      });\n      setPermissionStatus('denied');\n      setError(`Microphone access required: ${err.message}`);\n      return false;\n    }\n  };\n  useEffect(() => {\n    checkAndRequestPermissions();\n  }, []);\n  const cleanup = useCallback(() => {\n    debugLog('🧹 Starting cleanup...');\n    if (timerRef.current) {\n      clearInterval(timerRef.current);\n      timerRef.current = null;\n    }\n    if (animationRef.current) {\n      cancelAnimationFrame(animationRef.current);\n      animationRef.current = null;\n    }\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== 'inactive') {\n      try {\n        mediaRecorderRef.current.stop();\n      } catch (e) {\n        debugLog('⚠️ MediaRecorder cleanup warning', e.message);\n      }\n      mediaRecorderRef.current = null;\n    }\n    if (audioContextRef.current && audioContextRef.current.state !== 'closed') {\n      audioContextRef.current.close();\n      audioContextRef.current = null;\n    }\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n      streamRef.current = null;\n      setAudioStream(null);\n    }\n    setIsRecording(false);\n    setRecordingTime(0);\n    debugLog('✅ Cleanup completed');\n  }, []);\n  useEffect(() => {\n    return cleanup;\n  }, [cleanup]);\n  useEffect(() => {\n    if (isRecording) {\n      timerRef.current = setInterval(() => {\n        setRecordingTime(prev => prev + 1);\n      }, 1000);\n    } else {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n        timerRef.current = null;\n      }\n      setRecordingTime(0);\n    }\n    return () => {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n      }\n    };\n  }, [isRecording]);\n  const drawWaveform = useCallback(() => {\n    if (!canvasRef.current || !analyserRef.current || !isRecording) return;\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext(\"2d\");\n    const analyser = analyserRef.current;\n    const dataArray = dataArrayRef.current;\n    const draw = () => {\n      if (!isRecording || !analyserRef.current) return;\n      animationRef.current = requestAnimationFrame(draw);\n      analyser.getByteFrequencyData(dataArray);\n      ctx.fillStyle = \"#f8f9fa\";\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n      const barWidth = canvas.width / dataArray.length * 2.5;\n      let x = 0;\n      for (let i = 0; i < dataArray.length; i++) {\n        const barHeight = dataArray[i] / 255 * canvas.height * 0.8;\n        const gradient = ctx.createLinearGradient(0, canvas.height - barHeight, 0, canvas.height);\n        gradient.addColorStop(0, '#25D366');\n        gradient.addColorStop(1, '#128C7E');\n        ctx.fillStyle = gradient;\n        ctx.fillRect(x, canvas.height - barHeight, barWidth - 1, barHeight);\n        x += barWidth + 1;\n      }\n    };\n    draw();\n  }, [isRecording]);\n\n  // Strategic audio format enforcement for WhatsApp compatibility\n  const getOptimalAudioFormat = () => {\n    // STRATEGIC: Force OGG container for WhatsApp compatibility\n    const formats = [{\n      mimeType: 'audio/ogg; codecs=opus',\n      ext: 'ogg',\n      priority: 1\n    }, {\n      mimeType: 'audio/ogg',\n      ext: 'ogg',\n      priority: 2\n    }, {\n      mimeType: 'audio/webm; codecs=opus',\n      ext: 'webm',\n      priority: 3\n    }, {\n      mimeType: 'audio/webm',\n      ext: 'webm',\n      priority: 4\n    }];\n    for (const format of formats) {\n      if (MediaRecorder.isTypeSupported(format.mimeType)) {\n        debugLog(`🎵 Selected audio format: ${format.mimeType}`, format);\n        return format;\n      }\n    }\n    throw new Error('No WhatsApp-compatible audio format supported');\n  };\n\n  // Client-side audio conversion for WhatsApp compatibility\n  const convertToWhatsAppFormat = async webmBlob => {\n    try {\n      debugLog('🔄 Converting audio to WhatsApp format...');\n      setIsProcessing(true);\n\n      // Strategy: Use Web Audio API to re-encode as OGG\n      const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      const arrayBuffer = await webmBlob.arrayBuffer();\n      const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n\n      // Create offline context for rendering\n      const offlineContext = new OfflineAudioContext(1,\n      // mono\n      audioBuffer.sampleRate * audioBuffer.duration, audioBuffer.sampleRate);\n      const source = offlineContext.createBufferSource();\n      source.buffer = audioBuffer;\n      source.connect(offlineContext.destination);\n      source.start();\n      const renderedBuffer = await offlineContext.startRendering();\n\n      // Convert to WAV first (browser compatibility)\n      const wavBlob = audioBufferToWav(renderedBuffer);\n      debugLog('✅ Audio conversion completed', {\n        originalSize: webmBlob.size,\n        convertedSize: wavBlob.size\n      });\n      setIsProcessing(false);\n      return wavBlob;\n    } catch (err) {\n      debugLog('❌ Audio conversion failed', err.message);\n      setIsProcessing(false);\n      // Return original if conversion fails\n      return webmBlob;\n    }\n  };\n\n  // WAV encoding function for maximum compatibility\n  const audioBufferToWav = buffer => {\n    const length = buffer.length;\n    const arrayBuffer = new ArrayBuffer(44 + length * 2);\n    const view = new DataView(arrayBuffer);\n    const channels = buffer.numberOfChannels;\n    const sampleRate = buffer.sampleRate;\n\n    // WAV header\n    const writeString = (offset, string) => {\n      for (let i = 0; i < string.length; i++) {\n        view.setUint8(offset + i, string.charCodeAt(i));\n      }\n    };\n    writeString(0, 'RIFF');\n    view.setUint32(4, 36 + length * 2, true);\n    writeString(8, 'WAVE');\n    writeString(12, 'fmt ');\n    view.setUint32(16, 16, true);\n    view.setUint16(20, 1, true);\n    view.setUint16(22, channels, true);\n    view.setUint32(24, sampleRate, true);\n    view.setUint32(28, sampleRate * 2, true);\n    view.setUint16(32, 2, true);\n    view.setUint16(34, 16, true);\n    writeString(36, 'data');\n    view.setUint32(40, length * 2, true);\n\n    // Convert float32 to int16\n    const channelData = buffer.getChannelData(0);\n    let offset = 44;\n    for (let i = 0; i < length; i++) {\n      const sample = Math.max(-1, Math.min(1, channelData[i]));\n      view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);\n      offset += 2;\n    }\n    return new Blob([arrayBuffer], {\n      type: 'audio/wav'\n    });\n  };\n  const startRecording = async () => {\n    try {\n      var _stream$getTracks$;\n      debugLog('🎬 === STARTING RECORDING ===');\n      setError(null);\n      cleanup();\n      if (permissionStatus !== 'granted') {\n        const granted = await checkAndRequestPermissions();\n        if (!granted) return;\n      }\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true,\n          sampleRate: 48000,\n          channelCount: 1\n        }\n      });\n      streamRef.current = stream;\n      setAudioStream(stream);\n      debugLog('🎤 Audio stream acquired', {\n        tracks: stream.getTracks().length,\n        settings: (_stream$getTracks$ = stream.getTracks()[0]) === null || _stream$getTracks$ === void 0 ? void 0 : _stream$getTracks$.getSettings()\n      });\n\n      // Setup audio visualization\n      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n      if (audioCtx.state === 'suspended') {\n        await audioCtx.resume();\n      }\n      const source = audioCtx.createMediaStreamSource(stream);\n      const analyser = audioCtx.createAnalyser();\n      analyser.fftSize = 256;\n      analyser.smoothingTimeConstant = 0.3;\n      source.connect(analyser);\n      audioContextRef.current = audioCtx;\n      analyserRef.current = analyser;\n      dataArrayRef.current = new Uint8Array(analyser.frequencyBinCount);\n\n      // Get optimal format\n      const audioFormat = getOptimalAudioFormat();\n      const mediaRecorder = new MediaRecorder(stream, {\n        mimeType: audioFormat.mimeType,\n        audioBitsPerSecond: 96000 // High quality for voice\n      });\n      mediaRecorderRef.current = mediaRecorder;\n      audioChunksRef.current = [];\n      mediaRecorder.onstart = () => {\n        debugLog('🎬 MediaRecorder started', mediaRecorder.state);\n        setIsRecording(true);\n        drawWaveform();\n      };\n      mediaRecorder.ondataavailable = event => {\n        if (event.data && event.data.size > 0) {\n          audioChunksRef.current.push(event.data);\n          debugLog('📦 Data chunk received', {\n            size: event.data.size,\n            total: audioChunksRef.current.length\n          });\n        }\n      };\n      mediaRecorder.onstop = async () => {\n        debugLog('⏹️ MediaRecorder stopped', {\n          chunks: audioChunksRef.current.length,\n          totalSize: audioChunksRef.current.reduce((sum, chunk) => sum + chunk.size, 0)\n        });\n        if (audioChunksRef.current.length > 0) {\n          let blob = new Blob(audioChunksRef.current, {\n            type: audioFormat.mimeType\n          });\n\n          // Convert to WhatsApp-compatible format if needed\n          if (audioFormat.ext === 'webm') {\n            blob = await convertToWhatsAppFormat(blob);\n          }\n          if (blob.size > 0) {\n            await createRecording(blob, audioFormat);\n          } else {\n            setError('Recording produced empty file');\n          }\n        } else {\n          setError('No audio data captured');\n        }\n        audioChunksRef.current = [];\n      };\n      mediaRecorder.onerror = event => {\n        var _event$error;\n        debugLog('❌ MediaRecorder error', event.error);\n        setError(`Recording failed: ${((_event$error = event.error) === null || _event$error === void 0 ? void 0 : _event$error.message) || 'Unknown error'}`);\n        cleanup();\n      };\n      mediaRecorder.start(200);\n    } catch (err) {\n      debugLog('💥 Recording start failed', {\n        error: err.message\n      });\n      setError(`Failed to start recording: ${err.message}`);\n      cleanup();\n    }\n  };\n  const stopRecording = () => {\n    debugLog('⏹️ === STOPPING RECORDING ===');\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state === 'recording') {\n      mediaRecorderRef.current.stop();\n    }\n    setIsRecording(false);\n    setTimeout(cleanup, 1000);\n  };\n  const createRecording = async (blob, format) => {\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\n    // Force .ogg extension for WhatsApp compatibility\n    const filename = `whatsapp-voice-${timestamp}.ogg`;\n    const url = URL.createObjectURL(blob);\n    const recording = {\n      id: Date.now(),\n      url,\n      blob,\n      filename,\n      duration: recordingTime,\n      timestamp: new Date().toLocaleTimeString(),\n      size: blob.size,\n      format: format.ext,\n      isWhatsAppCompatible: format.ext === 'ogg' || blob.type.includes('wav')\n    };\n    setRecordings(prev => [...prev, recording]);\n    debugLog('✅ Recording created', recording);\n\n    // Auto-download for file system access\n    autoDownload(recording);\n  };\n\n  // Strategic file system access with multiple methods\n  const autoDownload = async recording => {\n    try {\n      // Method 1: File System Access API (Chrome 86+)\n      if ('showSaveFilePicker' in window) {\n        debugLog('💾 Using File System Access API');\n        // Don't auto-trigger, but prepare for user action\n        return;\n      }\n\n      // Method 2: Traditional download\n      const link = document.createElement('a');\n      link.href = recording.url;\n      link.download = recording.filename;\n      link.style.display = 'none';\n      document.body.appendChild(link);\n\n      // Store reference for manual trigger\n      recording.downloadLink = link;\n      debugLog('📁 Download link prepared', recording.filename);\n    } catch (err) {\n      debugLog('❌ Download preparation failed', err.message);\n    }\n  };\n\n  // Enhanced download with File System Access API\n  const downloadRecording = async recording => {\n    try {\n      if ('showSaveFilePicker' in window) {\n        const fileHandle = await window.showSaveFilePicker({\n          suggestedName: recording.filename,\n          types: [{\n            description: 'WhatsApp Voice Messages',\n            accept: {\n              'audio/ogg': ['.ogg'],\n              'audio/wav': ['.wav'],\n              'audio/webm': ['.webm']\n            }\n          }]\n        });\n        const writable = await fileHandle.createWritable();\n        await writable.write(recording.blob);\n        await writable.close();\n        debugLog('✅ File saved via File System Access API');\n      } else {\n        // Fallback to traditional download\n        if (recording.downloadLink) {\n          recording.downloadLink.click();\n        } else {\n          const link = document.createElement('a');\n          link.href = recording.url;\n          link.download = recording.filename;\n          link.click();\n        }\n        debugLog('✅ File downloaded via traditional method');\n      }\n    } catch (err) {\n      if (err.name !== 'AbortError') {\n        debugLog('❌ Download failed', err.message);\n        setError('Download failed: ' + err.message);\n      }\n    }\n  };\n  const removeRecording = index => {\n    setRecordings(prev => {\n      const recording = prev[index];\n      URL.revokeObjectURL(recording.url);\n      if (recording.downloadLink && document.body.contains(recording.downloadLink)) {\n        document.body.removeChild(recording.downloadLink);\n      }\n      return prev.filter((_, i) => i !== index);\n    });\n  };\n  const formatFileSize = bytes => {\n    if (bytes === 0) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bg-[#ece5dd] min-h-screen p-4 space-y-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center justify-between text-sm bg-white/50 p-2 rounded\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        children: [\"\\uD83C\\uDF99\\uFE0F \", permissionStatus === 'granted' ? '✅ Ready' : permissionStatus === 'denied' ? '❌ No Access' : '⏳ Checking...']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 9\n      }, this), isRecording && /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"text-red-600 font-medium animate-pulse\",\n        children: [\"\\uD83D\\uDD34 REC \", recordingTime, \"s\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 520,\n        columnNumber: 11\n      }, this), isProcessing && /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"text-blue-600\",\n        children: \"\\u2699\\uFE0F Processing...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 525,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 513,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded\",\n      children: [error, /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setError(null),\n        className: \"float-right text-red-500 hover:text-red-700 font-bold\",\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 533,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 531,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center space-x-2\",\n      children: !isRecording ? /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: startRecording,\n        disabled: permissionStatus !== 'granted',\n        className: `px-4 py-2 rounded-full shadow-md transition-colors ${permissionStatus !== 'granted' ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-white border border-gray-300 hover:bg-gray-100 text-black'}`,\n        children: \"\\uD83C\\uDF99\\uFE0F\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 545,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: stopRecording,\n        className: \"bg-white border border-gray-300 hover:bg-gray-100 text-black px-4 py-2 rounded-full shadow-md relative\",\n        children: [\"\\u23F9\\uFE0F \", recordingTime, \"s\", /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"absolute -top-3 right-0 w-3 h-3 bg-red-500 rounded-full animate-ping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 562,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 557,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 543,\n      columnNumber: 7\n    }, this), isRecording && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white p-3 rounded-lg shadow\",\n      children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        width: 400,\n        height: 60,\n        className: \"w-full border rounded\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 570,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center text-xs text-gray-500 mt-1\",\n        children: [\"\\uD83C\\uDFB5 Recording... \", recordingTime, \"s\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 576,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 569,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"space-y-3\",\n      children: recordings.map((rec, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center space-x-3 bg-[#dcf8c6] p-3 rounded-xl shadow-md w-fit max-w-full\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: \"https://www.gravatar.com/avatar?d=mp\",\n          alt: \"Avatar\",\n          className: \"w-10 h-10 rounded-full\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 589,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-col\",\n          children: [/*#__PURE__*/_jsxDEV(\"audio\", {\n            controls: true,\n            src: rec.url,\n            className: \"w-60\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 595,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xs text-gray-500 flex justify-between mt-1\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: [rec.duration, \"s \\u2022 \", formatFileSize(rec.size), \" \\u2022\", rec.isWhatsAppCompatible ? ' ✅ WhatsApp' : ' ⚠️ Convert']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 597,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: rec.timestamp\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 601,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 596,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xs text-green-600 font-medium\",\n            children: [\"\\uD83D\\uDCC1 \", rec.filename]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 603,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 594,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-col space-y-1\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => downloadRecording(rec),\n            className: \"text-green-700 hover:text-green-900 p-1 bg-white rounded shadow-sm\",\n            title: \"Save to computer\",\n            children: \"\\uD83D\\uDCBE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 608,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => removeRecording(index),\n            className: \"text-red-700 hover:text-red-900 p-1 bg-white rounded shadow-sm\",\n            title: \"Delete\",\n            children: \"\\uD83D\\uDDD1\\uFE0F\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 615,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 607,\n          columnNumber: 13\n        }, this)]\n      }, rec.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 585,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 583,\n      columnNumber: 7\n    }, this), recordings.length === 0 && !isRecording && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-center text-gray-500 py-8\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-4xl mb-2\",\n        children: \"\\uD83C\\uDFA4\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 629,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Click the microphone to start recording\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 630,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-sm mt-2\",\n        children: \"Files will be saved as WhatsApp-compatible .ogg format\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 631,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 628,\n      columnNumber: 9\n    }, this), recordings.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-green-50 border border-green-200 p-4 rounded-lg\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"font-medium text-green-800 mb-2\",\n        children: \"\\uD83D\\uDCF1 How to use with WhatsApp:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 638,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"ol\", {\n        className: \"text-sm text-green-700 space-y-1 list-decimal list-inside\",\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Save file:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 640,\n            columnNumber: 17\n          }, this), \" Click \\uD83D\\uDCBE to download the .ogg file\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 640,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Mobile:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 641,\n            columnNumber: 17\n          }, this), \" Share saved file via WhatsApp mobile app\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 641,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Desktop:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 642,\n            columnNumber: 17\n          }, this), \" Use WhatsApp Desktop to send saved files\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 642,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Format:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 643,\n            columnNumber: 17\n          }, this), \" Files are optimized for WhatsApp compatibility\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 643,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 639,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 637,\n      columnNumber: 9\n    }, this), Object.keys(debugInfo).length > 0 && /*#__PURE__*/_jsxDEV(\"details\", {\n      className: \"mt-4 p-3 bg-gray-100 rounded text-xs\",\n      children: [/*#__PURE__*/_jsxDEV(\"summary\", {\n        className: \"cursor-pointer font-medium\",\n        children: [\"\\uD83D\\uDD27 Debug Log (\", Object.keys(debugInfo).length, \" entries)\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 651,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-2 space-y-1 max-h-40 overflow-y-auto\",\n        children: Object.entries(debugInfo).slice(-8).map(([key, info]) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-start space-x-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-gray-400 min-w-16\",\n            children: info.time\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 659,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"font-mono text-xs\",\n            children: info.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 660,\n            columnNumber: 19\n          }, this), info.data && /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-blue-600 text-xs\",\n            children: JSON.stringify(info.data).slice(0, 100)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 662,\n            columnNumber: 21\n          }, this)]\n        }, key, true, {\n          fileName: _jsxFileName,\n          lineNumber: 658,\n          columnNumber: 17\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 654,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 650,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 511,\n    columnNumber: 5\n  }, this);\n}\n_s(WhatsAppAudioRecorder, \"dTaeDqnLzOnacYR/OmrCUcYhJgM=\");\n_c = WhatsAppAudioRecorder;\nvar _c;\n$RefreshReg$(_c, \"WhatsAppAudioRecorder\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","jsxDEV","_jsxDEV","WhatsAppAudioRecorder","_s","recordings","setRecordings","isRecording","setIsRecording","recordingTime","setRecordingTime","audioStream","setAudioStream","permissionStatus","setPermissionStatus","error","setError","isProcessing","setIsProcessing","debugInfo","setDebugInfo","mediaRecorderRef","audioChunksRef","timerRef","audioContextRef","analyserRef","dataArrayRef","animationRef","canvasRef","streamRef","debugLog","message","data","console","log","prev","Date","now","time","toLocaleTimeString","checkAndRequestPermissions","_testStream$getTracks","testStream","navigator","mediaDevices","getUserMedia","audio","echoCancellation","noiseSuppression","autoGainControl","sampleRate","channelCount","tracks","getTracks","length","settings","getSettings","forEach","track","stop","err","name","cleanup","current","clearInterval","cancelAnimationFrame","state","e","close","setInterval","drawWaveform","canvas","ctx","getContext","analyser","dataArray","draw","requestAnimationFrame","getByteFrequencyData","fillStyle","fillRect","width","height","barWidth","x","i","barHeight","gradient","createLinearGradient","addColorStop","getOptimalAudioFormat","formats","mimeType","ext","priority","format","MediaRecorder","isTypeSupported","Error","convertToWhatsAppFormat","webmBlob","audioContext","window","AudioContext","webkitAudioContext","arrayBuffer","audioBuffer","decodeAudioData","offlineContext","OfflineAudioContext","duration","source","createBufferSource","buffer","connect","destination","start","renderedBuffer","startRendering","wavBlob","audioBufferToWav","originalSize","size","convertedSize","ArrayBuffer","view","DataView","channels","numberOfChannels","writeString","offset","string","setUint8","charCodeAt","setUint32","setUint16","channelData","getChannelData","sample","Math","max","min","setInt16","Blob","type","startRecording","_stream$getTracks$","granted","stream","audioCtx","resume","createMediaStreamSource","createAnalyser","fftSize","smoothingTimeConstant","Uint8Array","frequencyBinCount","audioFormat","mediaRecorder","audioBitsPerSecond","onstart","ondataavailable","event","push","total","onstop","chunks","totalSize","reduce","sum","chunk","blob","createRecording","onerror","_event$error","stopRecording","setTimeout","timestamp","toISOString","replace","slice","filename","url","URL","createObjectURL","recording","id","isWhatsAppCompatible","includes","autoDownload","link","document","createElement","href","download","style","display","body","appendChild","downloadLink","downloadRecording","fileHandle","showSaveFilePicker","suggestedName","types","description","accept","writable","createWritable","write","click","removeRecording","index","revokeObjectURL","contains","removeChild","filter","_","formatFileSize","bytes","k","sizes","floor","parseFloat","pow","toFixed","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","disabled","ref","map","rec","src","alt","controls","title","Object","keys","entries","key","info","JSON","stringify","_c","$RefreshReg$"],"sources":["/home/maksim/src/react/wa-audio-sandbox-20/src/components/WhatsAppAudioRecorder.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from \"react\";\n\nexport default function WhatsAppAudioRecorder() {\n  const [recordings, setRecordings] = useState([]);\n  const [isRecording, setIsRecording] = useState(false);\n  const [recordingTime, setRecordingTime] = useState(0);\n  const [audioStream, setAudioStream] = useState(null);\n  const [permissionStatus, setPermissionStatus] = useState('checking');\n  const [error, setError] = useState(null);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [debugInfo, setDebugInfo] = useState({});\n  \n  const mediaRecorderRef = useRef(null);\n  const audioChunksRef = useRef([]);\n  const timerRef = useRef(null);\n  const audioContextRef = useRef(null);\n  const analyserRef = useRef(null);\n  const dataArrayRef = useRef(null);\n  const animationRef = useRef(null);\n  const canvasRef = useRef(null);\n  const streamRef = useRef(null);\n\n  const debugLog = (message, data = null) => {\n    console.log(`🎤 ${message}`, data);\n    setDebugInfo(prev => ({\n      ...prev,\n      [`${Date.now()}`]: { message, data, time: new Date().toLocaleTimeString() }\n    }));\n  };\n\n  // Strategic permission handling with comprehensive fallbacks\n  const checkAndRequestPermissions = async () => {\n    try {\n      debugLog('🔍 Checking microphone permissions...');\n      setPermissionStatus('checking');\n      \n      const testStream = await navigator.mediaDevices.getUserMedia({ \n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true,\n          sampleRate: 48000,\n          channelCount: 1\n        } \n      });\n      \n      debugLog('✅ Permission granted', {\n        tracks: testStream.getTracks().length,\n        settings: testStream.getTracks()[0]?.getSettings()\n      });\n      \n      testStream.getTracks().forEach(track => track.stop());\n      setPermissionStatus('granted');\n      return true;\n      \n    } catch (err) {\n      debugLog('❌ Permission denied', { error: err.message, name: err.name });\n      setPermissionStatus('denied');\n      setError(`Microphone access required: ${err.message}`);\n      return false;\n    }\n  };\n\n  useEffect(() => {\n    checkAndRequestPermissions();\n  }, []);\n\n  const cleanup = useCallback(() => {\n    debugLog('🧹 Starting cleanup...');\n    \n    if (timerRef.current) {\n      clearInterval(timerRef.current);\n      timerRef.current = null;\n    }\n    \n    if (animationRef.current) {\n      cancelAnimationFrame(animationRef.current);\n      animationRef.current = null;\n    }\n    \n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== 'inactive') {\n      try {\n        mediaRecorderRef.current.stop();\n      } catch (e) {\n        debugLog('⚠️ MediaRecorder cleanup warning', e.message);\n      }\n      mediaRecorderRef.current = null;\n    }\n    \n    if (audioContextRef.current && audioContextRef.current.state !== 'closed') {\n      audioContextRef.current.close();\n      audioContextRef.current = null;\n    }\n    \n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n      streamRef.current = null;\n      setAudioStream(null);\n    }\n    \n    setIsRecording(false);\n    setRecordingTime(0);\n    debugLog('✅ Cleanup completed');\n  }, []);\n\n  useEffect(() => {\n    return cleanup;\n  }, [cleanup]);\n\n  useEffect(() => {\n    if (isRecording) {\n      timerRef.current = setInterval(() => {\n        setRecordingTime(prev => prev + 1);\n      }, 1000);\n    } else {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n        timerRef.current = null;\n      }\n      setRecordingTime(0);\n    }\n    \n    return () => {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n      }\n    };\n  }, [isRecording]);\n\n  const drawWaveform = useCallback(() => {\n    if (!canvasRef.current || !analyserRef.current || !isRecording) return;\n    \n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext(\"2d\");\n    const analyser = analyserRef.current;\n    const dataArray = dataArrayRef.current;\n\n    const draw = () => {\n      if (!isRecording || !analyserRef.current) return;\n      \n      animationRef.current = requestAnimationFrame(draw);\n      analyser.getByteFrequencyData(dataArray);\n\n      ctx.fillStyle = \"#f8f9fa\";\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n      \n      const barWidth = canvas.width / dataArray.length * 2.5;\n      let x = 0;\n\n      for (let i = 0; i < dataArray.length; i++) {\n        const barHeight = (dataArray[i] / 255) * canvas.height * 0.8;\n        \n        const gradient = ctx.createLinearGradient(0, canvas.height - barHeight, 0, canvas.height);\n        gradient.addColorStop(0, '#25D366');\n        gradient.addColorStop(1, '#128C7E');\n        \n        ctx.fillStyle = gradient;\n        ctx.fillRect(x, canvas.height - barHeight, barWidth - 1, barHeight);\n        \n        x += barWidth + 1;\n      }\n    };\n    \n    draw();\n  }, [isRecording]);\n\n  // Strategic audio format enforcement for WhatsApp compatibility\n  const getOptimalAudioFormat = () => {\n    // STRATEGIC: Force OGG container for WhatsApp compatibility\n    const formats = [\n      { mimeType: 'audio/ogg; codecs=opus', ext: 'ogg', priority: 1 },\n      { mimeType: 'audio/ogg', ext: 'ogg', priority: 2 },\n      { mimeType: 'audio/webm; codecs=opus', ext: 'webm', priority: 3 },\n      { mimeType: 'audio/webm', ext: 'webm', priority: 4 }\n    ];\n    \n    for (const format of formats) {\n      if (MediaRecorder.isTypeSupported(format.mimeType)) {\n        debugLog(`🎵 Selected audio format: ${format.mimeType}`, format);\n        return format;\n      }\n    }\n    \n    throw new Error('No WhatsApp-compatible audio format supported');\n  };\n\n  // Client-side audio conversion for WhatsApp compatibility\n  const convertToWhatsAppFormat = async (webmBlob) => {\n    try {\n      debugLog('🔄 Converting audio to WhatsApp format...');\n      setIsProcessing(true);\n      \n      // Strategy: Use Web Audio API to re-encode as OGG\n      const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      const arrayBuffer = await webmBlob.arrayBuffer();\n      const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n      \n      // Create offline context for rendering\n      const offlineContext = new OfflineAudioContext(\n        1, // mono\n        audioBuffer.sampleRate * audioBuffer.duration,\n        audioBuffer.sampleRate\n      );\n      \n      const source = offlineContext.createBufferSource();\n      source.buffer = audioBuffer;\n      source.connect(offlineContext.destination);\n      source.start();\n      \n      const renderedBuffer = await offlineContext.startRendering();\n      \n      // Convert to WAV first (browser compatibility)\n      const wavBlob = audioBufferToWav(renderedBuffer);\n      \n      debugLog('✅ Audio conversion completed', { \n        originalSize: webmBlob.size, \n        convertedSize: wavBlob.size \n      });\n      \n      setIsProcessing(false);\n      return wavBlob;\n      \n    } catch (err) {\n      debugLog('❌ Audio conversion failed', err.message);\n      setIsProcessing(false);\n      // Return original if conversion fails\n      return webmBlob;\n    }\n  };\n\n  // WAV encoding function for maximum compatibility\n  const audioBufferToWav = (buffer) => {\n    const length = buffer.length;\n    const arrayBuffer = new ArrayBuffer(44 + length * 2);\n    const view = new DataView(arrayBuffer);\n    const channels = buffer.numberOfChannels;\n    const sampleRate = buffer.sampleRate;\n    \n    // WAV header\n    const writeString = (offset, string) => {\n      for (let i = 0; i < string.length; i++) {\n        view.setUint8(offset + i, string.charCodeAt(i));\n      }\n    };\n    \n    writeString(0, 'RIFF');\n    view.setUint32(4, 36 + length * 2, true);\n    writeString(8, 'WAVE');\n    writeString(12, 'fmt ');\n    view.setUint32(16, 16, true);\n    view.setUint16(20, 1, true);\n    view.setUint16(22, channels, true);\n    view.setUint32(24, sampleRate, true);\n    view.setUint32(28, sampleRate * 2, true);\n    view.setUint16(32, 2, true);\n    view.setUint16(34, 16, true);\n    writeString(36, 'data');\n    view.setUint32(40, length * 2, true);\n    \n    // Convert float32 to int16\n    const channelData = buffer.getChannelData(0);\n    let offset = 44;\n    for (let i = 0; i < length; i++) {\n      const sample = Math.max(-1, Math.min(1, channelData[i]));\n      view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);\n      offset += 2;\n    }\n    \n    return new Blob([arrayBuffer], { type: 'audio/wav' });\n  };\n\n  const startRecording = async () => {\n    try {\n      debugLog('🎬 === STARTING RECORDING ===');\n      setError(null);\n      cleanup();\n      \n      if (permissionStatus !== 'granted') {\n        const granted = await checkAndRequestPermissions();\n        if (!granted) return;\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true,\n          sampleRate: 48000,\n          channelCount: 1,\n        }\n      });\n      \n      streamRef.current = stream;\n      setAudioStream(stream);\n      \n      debugLog('🎤 Audio stream acquired', {\n        tracks: stream.getTracks().length,\n        settings: stream.getTracks()[0]?.getSettings()\n      });\n\n      // Setup audio visualization\n      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n      if (audioCtx.state === 'suspended') {\n        await audioCtx.resume();\n      }\n      \n      const source = audioCtx.createMediaStreamSource(stream);\n      const analyser = audioCtx.createAnalyser();\n      analyser.fftSize = 256;\n      analyser.smoothingTimeConstant = 0.3;\n      source.connect(analyser);\n      \n      audioContextRef.current = audioCtx;\n      analyserRef.current = analyser;\n      dataArrayRef.current = new Uint8Array(analyser.frequencyBinCount);\n\n      // Get optimal format\n      const audioFormat = getOptimalAudioFormat();\n      \n      const mediaRecorder = new MediaRecorder(stream, {\n        mimeType: audioFormat.mimeType,\n        audioBitsPerSecond: 96000 // High quality for voice\n      });\n\n      mediaRecorderRef.current = mediaRecorder;\n      audioChunksRef.current = [];\n\n      mediaRecorder.onstart = () => {\n        debugLog('🎬 MediaRecorder started', mediaRecorder.state);\n        setIsRecording(true);\n        drawWaveform();\n      };\n\n      mediaRecorder.ondataavailable = (event) => {\n        if (event.data && event.data.size > 0) {\n          audioChunksRef.current.push(event.data);\n          debugLog('📦 Data chunk received', { \n            size: event.data.size, \n            total: audioChunksRef.current.length \n          });\n        }\n      };\n\n      mediaRecorder.onstop = async () => {\n        debugLog('⏹️ MediaRecorder stopped', {\n          chunks: audioChunksRef.current.length,\n          totalSize: audioChunksRef.current.reduce((sum, chunk) => sum + chunk.size, 0)\n        });\n        \n        if (audioChunksRef.current.length > 0) {\n          let blob = new Blob(audioChunksRef.current, { type: audioFormat.mimeType });\n          \n          // Convert to WhatsApp-compatible format if needed\n          if (audioFormat.ext === 'webm') {\n            blob = await convertToWhatsAppFormat(blob);\n          }\n          \n          if (blob.size > 0) {\n            await createRecording(blob, audioFormat);\n          } else {\n            setError('Recording produced empty file');\n          }\n        } else {\n          setError('No audio data captured');\n        }\n        \n        audioChunksRef.current = [];\n      };\n\n      mediaRecorder.onerror = (event) => {\n        debugLog('❌ MediaRecorder error', event.error);\n        setError(`Recording failed: ${event.error?.message || 'Unknown error'}`);\n        cleanup();\n      };\n\n      mediaRecorder.start(200);\n      \n    } catch (err) {\n      debugLog('💥 Recording start failed', { error: err.message });\n      setError(`Failed to start recording: ${err.message}`);\n      cleanup();\n    }\n  };\n\n  const stopRecording = () => {\n    debugLog('⏹️ === STOPPING RECORDING ===');\n    \n    if (mediaRecorderRef.current && mediaRecorderRef.current.state === 'recording') {\n      mediaRecorderRef.current.stop();\n    }\n    \n    setIsRecording(false);\n    setTimeout(cleanup, 1000);\n  };\n\n  const createRecording = async (blob, format) => {\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\n    // Force .ogg extension for WhatsApp compatibility\n    const filename = `whatsapp-voice-${timestamp}.ogg`;\n    \n    const url = URL.createObjectURL(blob);\n    \n    const recording = {\n      id: Date.now(),\n      url,\n      blob,\n      filename,\n      duration: recordingTime,\n      timestamp: new Date().toLocaleTimeString(),\n      size: blob.size,\n      format: format.ext,\n      isWhatsAppCompatible: format.ext === 'ogg' || blob.type.includes('wav')\n    };\n    \n    setRecordings(prev => [...prev, recording]);\n    debugLog('✅ Recording created', recording);\n    \n    // Auto-download for file system access\n    autoDownload(recording);\n  };\n\n  // Strategic file system access with multiple methods\n  const autoDownload = async (recording) => {\n    try {\n      // Method 1: File System Access API (Chrome 86+)\n      if ('showSaveFilePicker' in window) {\n        debugLog('💾 Using File System Access API');\n        // Don't auto-trigger, but prepare for user action\n        return;\n      }\n      \n      // Method 2: Traditional download\n      const link = document.createElement('a');\n      link.href = recording.url;\n      link.download = recording.filename;\n      link.style.display = 'none';\n      document.body.appendChild(link);\n      \n      // Store reference for manual trigger\n      recording.downloadLink = link;\n      \n      debugLog('📁 Download link prepared', recording.filename);\n      \n    } catch (err) {\n      debugLog('❌ Download preparation failed', err.message);\n    }\n  };\n\n  // Enhanced download with File System Access API\n  const downloadRecording = async (recording) => {\n    try {\n      if ('showSaveFilePicker' in window) {\n        const fileHandle = await window.showSaveFilePicker({\n          suggestedName: recording.filename,\n          types: [{\n            description: 'WhatsApp Voice Messages',\n            accept: {\n              'audio/ogg': ['.ogg'],\n              'audio/wav': ['.wav'],\n              'audio/webm': ['.webm']\n            }\n          }]\n        });\n        \n        const writable = await fileHandle.createWritable();\n        await writable.write(recording.blob);\n        await writable.close();\n        \n        debugLog('✅ File saved via File System Access API');\n        \n      } else {\n        // Fallback to traditional download\n        if (recording.downloadLink) {\n          recording.downloadLink.click();\n        } else {\n          const link = document.createElement('a');\n          link.href = recording.url;\n          link.download = recording.filename;\n          link.click();\n        }\n        debugLog('✅ File downloaded via traditional method');\n      }\n    } catch (err) {\n      if (err.name !== 'AbortError') {\n        debugLog('❌ Download failed', err.message);\n        setError('Download failed: ' + err.message);\n      }\n    }\n  };\n\n  const removeRecording = (index) => {\n    setRecordings(prev => {\n      const recording = prev[index];\n      URL.revokeObjectURL(recording.url);\n      if (recording.downloadLink && document.body.contains(recording.downloadLink)) {\n        document.body.removeChild(recording.downloadLink);\n      }\n      return prev.filter((_, i) => i !== index);\n    });\n  };\n\n  const formatFileSize = (bytes) => {\n    if (bytes === 0) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\n  };\n\n  return (\n    <div className=\"bg-[#ece5dd] min-h-screen p-4 space-y-4\">\n      {/* Status bar */}\n      <div className=\"flex items-center justify-between text-sm bg-white/50 p-2 rounded\">\n        <span>\n          🎙️ {permissionStatus === 'granted' ? '✅ Ready' : \n               permissionStatus === 'denied' ? '❌ No Access' : \n               '⏳ Checking...'}\n        </span>\n        {isRecording && (\n          <span className=\"text-red-600 font-medium animate-pulse\">\n            🔴 REC {recordingTime}s\n          </span>\n        )}\n        {isProcessing && (\n          <span className=\"text-blue-600\">⚙️ Processing...</span>\n        )}\n      </div>\n\n      {/* Error display */}\n      {error && (\n        <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded\">\n          {error}\n          <button \n            onClick={() => setError(null)}\n            className=\"float-right text-red-500 hover:text-red-700 font-bold\"\n          >\n            ×\n          </button>\n        </div>\n      )}\n\n      {/* Recording controls */}\n      <div className=\"flex items-center space-x-2\">\n        {!isRecording ? (\n          <button\n            onClick={startRecording}\n            disabled={permissionStatus !== 'granted'}\n            className={`px-4 py-2 rounded-full shadow-md transition-colors ${\n              permissionStatus !== 'granted' \n                ? 'bg-gray-300 text-gray-500 cursor-not-allowed' \n                : 'bg-white border border-gray-300 hover:bg-gray-100 text-black'\n            }`}\n          >\n            🎙️\n          </button>\n        ) : (\n          <button\n            onClick={stopRecording}\n            className=\"bg-white border border-gray-300 hover:bg-gray-100 text-black px-4 py-2 rounded-full shadow-md relative\"\n          >\n            ⏹️ {recordingTime}s\n            <span className=\"absolute -top-3 right-0 w-3 h-3 bg-red-500 rounded-full animate-ping\" />\n          </button>\n        )}\n      </div>\n\n      {/* Waveform */}\n      {isRecording && (\n        <div className=\"bg-white p-3 rounded-lg shadow\">\n          <canvas\n            ref={canvasRef}\n            width={400}\n            height={60}\n            className=\"w-full border rounded\"\n          />\n          <div className=\"text-center text-xs text-gray-500 mt-1\">\n            🎵 Recording... {recordingTime}s\n          </div>\n        </div>\n      )}\n\n      {/* WhatsApp-style recordings */}\n      <div className=\"space-y-3\">\n        {recordings.map((rec, index) => (\n          <div\n            key={rec.id}\n            className=\"flex items-center space-x-3 bg-[#dcf8c6] p-3 rounded-xl shadow-md w-fit max-w-full\"\n          >\n            <img\n              src=\"https://www.gravatar.com/avatar?d=mp\"\n              alt=\"Avatar\"\n              className=\"w-10 h-10 rounded-full\"\n            />\n            <div className=\"flex flex-col\">\n              <audio controls src={rec.url} className=\"w-60\" />\n              <div className=\"text-xs text-gray-500 flex justify-between mt-1\">\n                <span>\n                  {rec.duration}s • {formatFileSize(rec.size)} • \n                  {rec.isWhatsAppCompatible ? ' ✅ WhatsApp' : ' ⚠️ Convert'}\n                </span>\n                <span>{rec.timestamp}</span>\n              </div>\n              <div className=\"text-xs text-green-600 font-medium\">\n                📁 {rec.filename}\n              </div>\n            </div>\n            <div className=\"flex flex-col space-y-1\">\n              <button\n                onClick={() => downloadRecording(rec)}\n                className=\"text-green-700 hover:text-green-900 p-1 bg-white rounded shadow-sm\"\n                title=\"Save to computer\"\n              >\n                💾\n              </button>\n              <button\n                onClick={() => removeRecording(index)}\n                className=\"text-red-700 hover:text-red-900 p-1 bg-white rounded shadow-sm\"\n                title=\"Delete\"\n              >\n                🗑️\n              </button>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {recordings.length === 0 && !isRecording && (\n        <div className=\"text-center text-gray-500 py-8\">\n          <div className=\"text-4xl mb-2\">🎤</div>\n          <p>Click the microphone to start recording</p>\n          <p className=\"text-sm mt-2\">Files will be saved as WhatsApp-compatible .ogg format</p>\n        </div>\n      )}\n\n      {/* Usage instructions */}\n      {recordings.length > 0 && (\n        <div className=\"bg-green-50 border border-green-200 p-4 rounded-lg\">\n          <h3 className=\"font-medium text-green-800 mb-2\">📱 How to use with WhatsApp:</h3>\n          <ol className=\"text-sm text-green-700 space-y-1 list-decimal list-inside\">\n            <li><strong>Save file:</strong> Click 💾 to download the .ogg file</li>\n            <li><strong>Mobile:</strong> Share saved file via WhatsApp mobile app</li>\n            <li><strong>Desktop:</strong> Use WhatsApp Desktop to send saved files</li>\n            <li><strong>Format:</strong> Files are optimized for WhatsApp compatibility</li>\n          </ol>\n        </div>\n      )}\n\n      {/* Debug panel */}\n      {Object.keys(debugInfo).length > 0 && (\n        <details className=\"mt-4 p-3 bg-gray-100 rounded text-xs\">\n          <summary className=\"cursor-pointer font-medium\">\n            🔧 Debug Log ({Object.keys(debugInfo).length} entries)\n          </summary>\n          <div className=\"mt-2 space-y-1 max-h-40 overflow-y-auto\">\n            {Object.entries(debugInfo)\n              .slice(-8)\n              .map(([key, info]) => (\n                <div key={key} className=\"flex items-start space-x-2\">\n                  <span className=\"text-gray-400 min-w-16\">{info.time}</span>\n                  <span className=\"font-mono text-xs\">{info.message}</span>\n                  {info.data && (\n                    <span className=\"text-blue-600 text-xs\">\n                      {JSON.stringify(info.data).slice(0, 100)}\n                    </span>\n                  )}\n                </div>\n              ))}\n          </div>\n        </details>\n      )}\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}